#!/usr/bin/env python
# -*- coding=utf-8 -*-

import time  as sysTime
from time import time

from util.geo.GeoUtil import GeoUtil
from util.io.FileUtil import FileUtil

import gevent
import gevent.monkey
gevent.monkey.patch_thread()
gevent.monkey.patch_socket()

from service.map.baidu.SnatcherService import BaiduMapSnatcherService
import logging
import logging.config
from setting import baidu_map_uadb_setting


from shapely.geometry import Polygon

logging.config.fileConfig(FileUtil().getLogConfigPath())
logger = logging.getLogger("ugc")

goodAkList = ["你的ak"
             ]

# 数据库配置
dao_setting = baidu_map_uadb_setting

# 中国
# polygon_target = Polygon(((108.533701, 21.550861), (109.269592, 21.240711), (109.821511, 21.413099), (109.536353, 20.964466),
#                           (109.343182, 20.609772), (109.085619, 19.950084), (108.496906, 19.427295), (108.165755, 18.867771),
#                           (109.784717, 17.601983), (110.594198, 18.587295), (111.2439, 19.749686), (110.719577, 20.531601),
#                           (110.811563, 21.162871), (111.078324, 21.404286), (113.957501, 21.800021), (117.324207, 23.252826),
#                           (119.844636, 25.268352), (122.590433, 30.245623), (121.92813, 32.362247), (120.456346, 34.430003),
#                           (121.560184, 36.536529), (123.105557, 36.980639), (117.751944, 38.514484), (117.899122, 38.889325),
#                           (118.248671, 38.975545), (118.579822, 38.874944), (121.146245, 40.72668), (121.698164, 40.768656),
#                           (122.047713, 40.572537), (122.047713, 40.347691), (121.127848, 39.583242), (121.072656, 38.579502),
#                           (122.434056, 39.068831), (124.402567, 39.810643), (126.941393, 41.436644), (128.817918, 41.71295),
#                           (130.105729, 42.589116), (130.804826, 42.261985), (130.84162, 42.806247), (131.31995, 42.887474),
#                           (131.301553, 44.482813), (131.11758, 44.850436), (132.037445, 45.202705), (133.012501, 44.98116),
#                           (133.251666, 45.111586), (134.116339, 46.399379), (134.870628, 47.744231), (135.109793, 48.568976),
#                           (131.411937, 47.806239), (130.768031, 48.115169), (131.025593, 48.360974), (130.657647, 48.642183),
#                           (130.768031, 48.982407), (126.223899, 52.829883), (124.273785, 53.602875), (121.661369, 53.537167),
#                           (120.631121, 53.317399), (119.932023, 52.807591), (120.042407, 52.449359), (119.122542, 50.496506),
#                           (119.196131, 50.166769), (115.406288, 47.942397), (116.14218, 47.520382), (118.129088, 47.942397),
#                           (119.085748, 47.545302), (119.932023, 46.716655), (118.570623, 46.868285), (116.767688, 46.539211),
#                           (116.14218, 46.028999), (115.958207, 45.694795), (114.486424, 45.488126), (112.573105, 45.124612),
#                           (112.094775, 45.202705), (111.211705, 44.627516), (111.064526, 43.673795), (104.588678, 42.104626),
#                           (96.2731, 43.298713), (93.476711, 45.098557), (90.680321, 45.514002), (88.98777, 48.532332),
#                           (82.217565, 47.094924), (79.421176, 44.784961), (79.789122, 42.43258), (76.183251, 40.94327),
#                           (73.092506, 39.987775), (79.05323, 30.914198), (86.338559, 27.755075), (89.282127, 27.032511),
#                           (92.225694, 26.768583), (98.480775, 27.164241), (97.229759, 23.960657), (99.437435, 21.778542),
#                           (102.307413, 21.296561), (101.865878, 22.464245), (105.986872, 22.80582),(106.869943, 21.709787),
#                           (107.642629, 21.399979), (107.642629, 21.399979)))

# 南京
polygon_target = Polygon(((119.147396, 31.451172), (119.147626, 31.457387), (119.155461, 31.464263), (119.162336, 31.481678), (119.162304, 31.486827), (119.155349, 31.49063), (119.156879, 31.496398), (119.15946, 31.499533), (119.172845, 31.499808), (119.179149, 31.504643), (119.19004, 31.506324), (119.203972, 31.526649), (119.189396, 31.53376), (119.189134, 31.546082), (119.195206, 31.557594), (119.204647, 31.557852), (119.212171, 31.562849), (119.213076, 31.56887), (119.222426, 31.57607), (119.225005, 31.584546), (119.222546, 31.590837), (119.235318, 31.617271), (119.240656, 31.632783), (119.239104, 31.637992), (119.219036, 31.633404), (119.218389, 31.639124), (119.212805, 31.642835), (119.21132, 31.6524), (119.193823, 31.655211), (119.199334, 31.665101), (119.192572, 31.677536), (119.19695, 31.693067), (119.192954, 31.700201), (119.163847, 31.705982), (119.145188, 31.728284), (119.135825, 31.729598), (119.13156, 31.741713), (119.121033, 31.74601), (119.115491, 31.752556), (119.11742, 31.757067), (119.101021, 31.761297), (119.096253, 31.775664), (119.092378, 31.779704), (119.084071, 31.779999), (119.083665, 31.78983), (119.072255, 31.788041), (119.062107, 31.795229), (119.05321, 31.794888), (119.041397, 31.790012), (119.034333, 31.79052), (119.021677, 31.780942), (119.012977, 31.784761), (119.005457, 31.773021), (118.987506, 31.773816), (118.989405, 31.788963), (119.00948, 31.789319), (119.014411, 31.798312), (119.013153, 31.804704), (119.004522, 31.808776), (118.994918, 31.823248), (118.979629, 31.82859), (118.976079, 31.840311), (118.984465, 31.841931), (118.986302, 31.848011), (119.036431, 31.854505), (119.040106, 31.860406), (119.049807, 31.860792), (119.052301, 31.86476), (119.075475, 31.875195), (119.079904, 31.870041), (119.101047, 31.865819), (119.107064, 31.87246), (119.110669, 31.88603), (119.115849, 31.890615), (119.124416, 31.892156), (119.126011, 31.89726), (119.125595, 31.903644), (119.117899, 31.907031), (119.115053, 31.92868), (119.108022, 31.938724), (119.098071, 31.937525), (119.07489, 31.94548), (119.054033, 31.942732), (119.041638, 31.948253), (119.0358, 31.95659), (119.035715, 31.963415), (119.05309, 31.975012), (119.0714, 31.979533), (119.08154, 31.975278), (119.089448, 31.980036), (119.096742, 31.979838), (119.112303, 31.970836), (119.1175, 31.974793), (119.120509, 31.98559), (119.12748, 31.986385), (119.128206, 31.990683), (119.120919, 31.993639), (119.119066, 32.006165), (119.110651, 32.010473), (119.106451, 32.007985), (119.098962, 32.009794), (119.104511, 32.016886), (119.093202, 32.05864), (119.10516, 32.077276), (119.106815, 32.094483), (119.104042, 32.097603), (119.096383, 32.095399), (119.093003, 32.097978), (119.086351, 32.113152), (119.076235, 32.114012), (119.064137, 32.108463), (119.060157, 32.110458), (119.053517, 32.107846), (119.046892, 32.114746), (119.047366, 32.119337), (119.014788, 32.120269), (119.017539, 32.131831), (119.026786, 32.135426), (119.039657, 32.156897), (119.050029, 32.165458), (119.082582, 32.167576), (119.08552, 32.184844), (119.125468, 32.192353), (119.141716, 32.199784), (119.161276, 32.192695), (119.190798, 32.196084), (119.197997, 32.191474), (119.203893, 32.191509), (119.222663, 32.196924), (119.226351, 32.205723), (119.242031, 32.216198), (119.247036, 32.225619), (119.241592, 32.229125), (119.230993, 32.229202), (119.148198, 32.250854), (119.112839, 32.250039), (119.094349, 32.246284), (119.082998, 32.253653), (119.068795, 32.249321), (119.043509, 32.266229), (119.047491, 32.27807), (119.042787, 32.300983), (119.046449, 32.30975), (119.04205, 32.315071), (119.043613, 32.333236), (119.048398, 32.33965), (119.03488, 32.351378), (119.033753, 32.357628), (119.042474, 32.362194), (119.050678, 32.372882), (119.029504, 32.383556), (119.031781, 32.386499), (119.044828, 32.387936), (119.045429, 32.391203), (119.043582, 32.395495), (119.02963, 32.397165), (119.028545, 32.402645), (119.024029, 32.405397), (119.022971, 32.419302), (119.03595, 32.435146), (119.028549, 32.447643), (119.030203, 32.456972), (119.037218, 32.461503), (119.042358, 32.458787), (119.053185, 32.469647), (119.073963, 32.468466), (119.070922, 32.488471), (119.052249, 32.504396), (119.047585, 32.521352), (119.026271, 32.524651), (119.014063, 32.520024), (119.012411, 32.514868), (119.004023, 32.509682), (118.981657, 32.511988), (118.975595, 32.533405), (118.951424, 32.549602), (118.942924, 32.564302), (118.923048, 32.562725), (118.920942, 32.55519), (118.91284, 32.558531), (118.912592, 32.564281), (118.905799, 32.559185), (118.894449, 32.560821), (118.901024, 32.567777), (118.905152, 32.566634), (118.903639, 32.582235), (118.915644, 32.592805), (118.91427, 32.598765), (118.902497, 32.592303), (118.891642, 32.592275), (118.887812, 32.584459), (118.880008, 32.588524), (118.880368, 32.582202), (118.862592, 32.580035), (118.850105, 32.57281), (118.8512, 32.580629), (118.842699, 32.576569), (118.833568, 32.578746), (118.825776, 32.590266), (118.832033, 32.601471), (118.83142, 32.607999), (118.827463, 32.610473), (118.811757, 32.599779), (118.808675, 32.590866), (118.79123, 32.588705), (118.780687, 32.593911), (118.78203, 32.604131), (118.769479, 32.609556), (118.750952, 32.604526), (118.748889, 32.596502), (118.742117, 32.59446), (118.732625, 32.602042), (118.731755, 32.614367), (118.72537, 32.618713), (118.723944, 32.615883), (118.70413, 32.612265), (118.707333, 32.594705), (118.702996, 32.594698), (118.701117, 32.603267), (118.693661, 32.611479), (118.698287, 32.599614), (118.695985, 32.594862), (118.677834, 32.601049), (118.668497, 32.599845), (118.664353, 32.605161), (118.639981, 32.583381), (118.630451, 32.598083), (118.608383, 32.603166), (118.604648, 32.607207), (118.575571, 32.5923), (118.570181, 32.57073), (118.584775, 32.558756), (118.612451, 32.546025), (118.615494, 32.542493), (118.611104, 32.52862), (118.621077, 32.526088), (118.623429, 32.521393), (118.621952, 32.514166), (118.614603, 32.507474), (118.601638, 32.508671), (118.598991, 32.506163), (118.599848, 32.487879), (118.63472, 32.473338), (118.640887, 32.477015), (118.64999, 32.476365), (118.654229, 32.482496), (118.67897, 32.475751), (118.697382, 32.478522), (118.698104, 32.459713), (118.692466, 32.434236), (118.695103, 32.406439), (118.684705, 32.398222), (118.694444, 32.391076), (118.697995, 32.383717), (118.702381, 32.389332), (118.708187, 32.386295), (118.704741, 32.381237), (118.710051, 32.375774), (118.703131, 32.372719), (118.70698, 32.364474), (118.699891, 32.360493), (118.705715, 32.355751), (118.70327, 32.349427), (118.713157, 32.345512), (118.714052, 32.33938), (118.709624, 32.335619), (118.690488, 32.333128), (118.691495, 32.329916), (118.70373, 32.325508), (118.702387, 32.323215), (118.683603, 32.322074), (118.66514, 32.309005), (118.666592, 32.303173), (118.675321, 32.301884), (118.67757, 32.292748), (118.667706, 32.270443), (118.6825, 32.261471), (118.683669, 32.256469), (118.652856, 32.216262), (118.635816, 32.207738), (118.622744, 32.210067), (118.601533, 32.202573), (118.576623, 32.207806), (118.567162, 32.203753), (118.558481, 32.204898), (118.546244, 32.199355), (118.536764, 32.201389), (118.52958, 32.195346), (118.516517, 32.200075), (118.515014, 32.189943), (118.502245, 32.182718), (118.502273, 32.170857), (118.515613, 32.143384), (118.504634, 32.144848), (118.50541, 32.139811), (118.501179, 32.136955), (118.507166, 32.127212), (118.482753, 32.123886), (118.479286, 32.121728), (118.479214, 32.115881), (118.469439, 32.107649), (118.455509, 32.104249), (118.438027, 32.092903), (118.421833, 32.09403), (118.41833, 32.087464), (118.411198, 32.085806), (118.410358, 32.081522), (118.401416, 32.082112), (118.400728, 32.070392), (118.391688, 32.066094), (118.400939, 32.054731), (118.394621, 32.047923), (118.39259, 32.038789), (118.394766, 32.032718), (118.402415, 32.028097), (118.396248, 32.017731), (118.397612, 31.99524), (118.393793, 31.988938), (118.381344, 31.985977), (118.386597, 31.974024), (118.374397, 31.961258), (118.369429, 31.937819), (118.383277, 31.92996), (118.391894, 31.916664), (118.409497, 31.919607), (118.425882, 31.904032), (118.434558, 31.902514), (118.444688, 31.905087), (118.454319, 31.895251), (118.47862, 31.885638), (118.472514, 31.866539), (118.481421, 31.857309), (118.49689, 31.84939), (118.511281, 31.847436), (118.490309, 31.794592), (118.491096, 31.785576), (118.496669, 31.781898), (118.509807, 31.783711), (118.517358, 31.77134), (118.530153, 31.767893), (118.540352, 31.773332), (118.551938, 31.768435), (118.553799, 31.765294), (118.547957, 31.764155), (118.544955, 31.756426), (118.535924, 31.754553), (118.528698, 31.748932), (118.536553, 31.748338), (118.537649, 31.742353), (118.54279, 31.744705), (118.550584, 31.73785), (118.555126, 31.743499), (118.561209, 31.734576), (118.578155, 31.752546), (118.581766, 31.747196), (118.585837, 31.746877), (118.609267, 31.760771), (118.623234, 31.755395), (118.630781, 31.762592), (118.638573, 31.763213), (118.648508, 31.755687), (118.64444, 31.748077), (118.652456, 31.745091), (118.654947, 31.736528), (118.674403, 31.734758), (118.687359, 31.729113), (118.690129, 31.710369), (118.683565, 31.705178), (118.672771, 31.703127), (118.675136, 31.69629), (118.669693, 31.693951), (118.668049, 31.687888), (118.648174, 31.687368), (118.647416, 31.680802), (118.65456, 31.671292), (118.646369, 31.661278), (118.65162, 31.657684), (118.651551, 31.652841), (118.693111, 31.642265), (118.718103, 31.64835), (118.725882, 31.63343), (118.731528, 31.63314), (118.731881, 31.636771), (118.739421, 31.638465), (118.748982, 31.647277), (118.746791, 31.651294), (118.753419, 31.660604), (118.750513, 31.668672), (118.754732, 31.681427), (118.76669, 31.686086), (118.774832, 31.683473), (118.780648, 31.688708), (118.804586, 31.675025), (118.79902, 31.665729), (118.789385, 31.662474), (118.799255, 31.642047), (118.796889, 31.636404), (118.802469, 31.634668), (118.809508, 31.625615), (118.820988, 31.625505), (118.827081, 31.62943), (118.826022, 31.634718), (118.839754, 31.636537), (118.854817, 31.629767), (118.864809, 31.62984), (118.875337, 31.617076), (118.877397, 31.60505), (118.86854, 31.599105), (118.883749, 31.596051), (118.8782, 31.579963), (118.888521, 31.571021), (118.879466, 31.551184), (118.880613, 31.538024), (118.890463, 31.537388), (118.892802, 31.533618), (118.889749, 31.502378), (118.872749, 31.450968), (118.875957, 31.428655), (118.85813, 31.401955), (118.845424, 31.394039), (118.841358, 31.390018), (118.842764, 31.387459), (118.816456, 31.376901), (118.776924, 31.370767), (118.779132, 31.380994), (118.773141, 31.393506), (118.763709, 31.391752), (118.75138, 31.37478), (118.745573, 31.357743), (118.727757, 31.331689), (118.715597, 31.30628), (118.707724, 31.303637), (118.699751, 31.305015), (118.725885, 31.285036), (118.762892, 31.276068), (118.775131, 31.264627), (118.784072, 31.246898), (118.794647, 31.240085), (118.807982, 31.235565), (118.81486, 31.240905), (118.825927, 31.24208), (118.831427, 31.235911), (118.837802, 31.235331), (118.858179, 31.245977), (118.876885, 31.248175), (118.904315, 31.244413), (118.922137, 31.250624), (118.952889, 31.241724), (118.98811, 31.244187), (118.993096, 31.236836), (118.997991, 31.236067), (119.025694, 31.247933), (119.029362, 31.244415), (119.045898, 31.244561), (119.055297, 31.239883), (119.074125, 31.243443), (119.083023, 31.238112), (119.091107, 31.245898), (119.111856, 31.240308), (119.113641, 31.256272), (119.118583, 31.262006), (119.138711, 31.268805), (119.147122, 31.282233), (119.156523, 31.283478), (119.163939, 31.298857), (119.180472, 31.299127), (119.187398, 31.306352), (119.194872, 31.307346), (119.195368, 31.313851), (119.202346, 31.31616), (119.200243, 31.324343), (119.205731, 31.33651), (119.225867, 31.35409), (119.220769, 31.361583), (119.211092, 31.363633), (119.206907, 31.374631), (119.196289, 31.385345), (119.180574, 31.387206), (119.175616, 31.400356), (119.175655, 31.427821), (119.170845, 31.447256), (119.161978, 31.444991), (119.147396, 31.451172)))
# 苏州
# polygon_target = Polygon(((121.112431, 31.372062), (121.126981, 31.374985), (121.120405, 31.379692), (121.154598, 31.391284), (121.149869, 31.398398), (121.155717, 31.400427), (121.154055, 31.403383), (121.15936, 31.404423), (121.155607, 31.406543), (121.164715, 31.414346), (121.152402, 31.427), (121.168118, 31.431035), (121.171554, 31.436777), (121.169097, 31.440031), (121.154688, 31.441721), (121.154436, 31.449193), (121.167969, 31.455198), (121.187854, 31.45834), (121.192151, 31.460951), (121.193871, 31.468053), (121.215636, 31.483378), (121.221305, 31.485386), (121.22007, 31.482509), (121.225224, 31.481884), (121.237125, 31.487036), (121.234982, 31.488498), (121.241471, 31.499243), (121.248463, 31.49919), (121.251019, 31.487212), (121.254761, 31.487855), (121.253678, 31.483021), (121.259906, 31.485415), (121.266797, 31.483704), (121.275258, 31.493349), (121.278593, 31.490023), (121.28788, 31.496863), (121.296292, 31.494681), (121.297409, 31.497416), (121.299654, 31.49548), (121.304831, 31.497481), (121.311861, 31.511432), (121.317099, 31.511793), (121.320001, 31.50673), (121.326415, 31.511992), (121.326513, 31.505825), (121.330245, 31.505665), (121.333595, 31.510589), (121.345062, 31.514755), (121.39356, 31.550194), (121.328388, 31.589487), (121.271857, 31.652068), (121.233355, 31.681521), (121.083273, 31.78336), (121.067099, 31.789251), (121.013854, 31.788694), (120.923006, 31.814553), (120.901957, 31.82543), (120.866793, 31.879234), (120.794863, 32.00376), (120.788964, 32.008922), (120.722783, 32.013281), (120.651389, 32.008981), (120.582513, 32.00978), (120.555631, 32.019861), (120.487081, 32.036856), (120.44294, 32.040481), (120.429212, 32.036778), (120.368234, 31.991554), (120.382492, 31.948331), (120.397796, 31.934592), (120.393601, 31.926773), (120.384731, 31.920734), (120.443086, 31.901157), (120.472923, 31.896074), (120.475238, 31.885923), (120.497296, 31.877644), (120.508704, 31.858888), (120.509783, 31.847846), (120.518243, 31.848242), (120.537943, 31.833538), (120.535539, 31.819941), (120.529129, 31.812076), (120.538153, 31.793469), (120.55116, 31.792754), (120.553156, 31.797283), (120.56253, 31.799152), (120.563348, 31.790164), (120.576618, 31.798615), (120.590683, 31.788392), (120.594961, 31.768857), (120.60124, 31.766781), (120.60644, 31.750995), (120.595882, 31.741254), (120.590821, 31.740723), (120.588924, 31.7274), (120.591553, 31.720701), (120.606186, 31.716135), (120.593025, 31.698003), (120.574736, 31.691431), (120.572017, 31.685722), (120.575673, 31.683061), (120.576736, 31.675329), (120.57334, 31.666469), (120.565163, 31.663123), (120.59824, 31.65716), (120.602256, 31.650114), (120.596579, 31.642628), (120.601974, 31.63775), (120.598525, 31.631373), (120.607499, 31.621515), (120.598748, 31.61795), (120.583574, 31.620302), (120.573659, 31.615126), (120.571508, 31.60833), (120.562723, 31.607932), (120.559703, 31.61134), (120.549711, 31.607395), (120.551707, 31.591382), (120.55736, 31.580858), (120.570685, 31.584549), (120.57954, 31.583538), (120.574749, 31.589012), (120.577832, 31.591418), (120.600525, 31.590631), (120.610835, 31.534072), (120.609166, 31.526309), (120.601385, 31.521857), (120.599567, 31.530629), (120.591584, 31.533915), (120.560216, 31.514882), (120.55245, 31.501747), (120.561327, 31.482903), (120.548891, 31.475243), (120.532215, 31.474193), (120.522401, 31.469311), (120.520497, 31.464413), (120.508464, 31.463142), (120.502966, 31.456389), (120.477513, 31.451258), (120.442042, 31.455783), (120.440412, 31.453317), (120.426749, 31.453649), (120.378539, 31.432251), (120.265236, 31.391383), (120.242354, 31.363634), (120.195226, 31.338748), (120.176509, 31.323376), (120.140958, 31.283797), (120.126455, 31.274119), (120.105717, 31.267809), (120.01198, 31.258669), (119.925155, 31.172505), (119.931206, 31.161981), (119.945982, 31.149168), (119.954252, 31.110704), (119.980078, 31.075157), (119.991631, 31.066604), (120.000098, 31.038851), (120.022275, 31.023593), (120.059529, 31.011328), (120.107411, 30.971135), (120.137856, 30.95049), (120.203329, 30.937395), (120.261887, 30.93272), (120.312729, 30.937177), (120.377934, 30.954818), (120.365988, 30.93982), (120.369252, 30.929412), (120.364127, 30.924536), (120.363381, 30.917263), (120.370051, 30.890829), (120.373536, 30.889636), (120.391364, 30.896898), (120.402826, 30.89569), (120.425255, 30.901626), (120.428743, 30.911213), (120.424038, 30.931507), (120.430003, 30.933096), (120.43942, 30.927374), (120.44423, 30.920027), (120.441081, 30.893734), (120.45969, 30.875796), (120.450912, 30.870781), (120.44787, 30.862156), (120.45987, 30.856245), (120.466848, 30.846061), (120.468376, 30.834445), (120.463768, 30.830334), (120.464687, 30.822339), (120.472621, 30.812327), (120.481585, 30.811099), (120.482593, 30.795046), (120.496934, 30.769437), (120.510598, 30.764191), (120.566149, 30.838707), (120.593537, 30.858928), (120.616855, 30.856394), (120.633638, 30.864032), (120.650414, 30.863422), (120.661163, 30.852293), (120.666126, 30.868563), (120.669939, 30.866877), (120.68938, 30.888427), (120.699638, 30.876743), (120.70642, 30.874031), (120.710396, 30.877197), (120.707199, 30.88843), (120.719348, 30.89177), (120.715997, 30.939942), (120.708166, 30.952044), (120.691392, 30.961375), (120.704684, 30.976955), (120.710777, 30.972559), (120.716537, 30.978233), (120.732035, 30.977899), (120.744485, 30.968999), (120.752443, 30.96859), (120.765037, 30.980399), (120.776302, 30.983008), (120.774428, 30.993263), (120.777314, 31.001887), (120.809464, 31.011281), (120.828171, 31.012547), (120.846509, 31.004193), (120.852982, 30.996774), (120.862984, 31.000047), (120.871029, 30.996001), (120.873125, 31.000694), (120.897944, 31.009418), (120.901738, 31.023011), (120.907988, 31.023971), (120.908409, 31.039329), (120.912676, 31.040368), (120.900941, 31.054916), (120.905753, 31.083248), (120.910735, 31.08531), (120.90898, 31.091014), (120.903128, 31.092058), (120.899062, 31.103328), (120.895672, 31.099893), (120.884803, 31.101227), (120.883361, 31.106039), (120.875671, 31.103224), (120.862515, 31.108363), (120.862372, 31.11466), (120.875632, 31.123646), (120.8872, 31.141154), (120.914462, 31.140592), (120.942299, 31.147946), (120.959342, 31.147622), (120.985026, 31.140707), (121.011759, 31.140932), (121.029341, 31.144493), (121.034764, 31.14983), (121.035025, 31.147128), (121.039758, 31.148142), (121.045054, 31.143035), (121.051768, 31.150875), (121.048551, 31.155709), (121.051182, 31.160709), (121.056356, 31.156714), (121.066066, 31.159403), (121.075067, 31.154637), (121.082828, 31.173019), (121.077122, 31.18795), (121.081434, 31.190765), (121.07613, 31.18922), (121.075211, 31.191683), (121.078023, 31.192345), (121.078375, 31.199239), (121.072461, 31.201297), (121.075533, 31.20281), (121.069125, 31.232333), (121.073736, 31.239254), (121.067468, 31.242879), (121.070373, 31.252502), (121.063383, 31.252467), (121.067894, 31.254208), (121.068593, 31.274428), (121.089053, 31.278513), (121.090943, 31.282218), (121.087602, 31.284521), (121.093796, 31.298626), (121.100998, 31.296131), (121.099874, 31.290635), (121.109246, 31.281482), (121.120855, 31.291669), (121.149148, 31.283176), (121.149382, 31.280265), (121.158555, 31.281253), (121.167789, 31.289605), (121.158801, 31.295888), (121.15126, 31.3141), (121.145489, 31.311947), (121.14556, 31.308673), (121.136567, 31.308405), (121.134933, 31.325068), (121.140029, 31.336069), (121.136169, 31.341628), (121.137113, 31.350396), (121.124882, 31.34952), (121.123584, 31.358136), (121.114753, 31.357056), (121.112431, 31.372062)))

# 苏州工业园区
# polygon_target = Polygon(((120.699452, 31.455197), (120.717274, 31.248457), (120.652884, 31.284016), (120.634487, 31.351144),
#                           (120.660358, 31.371865), (120.720724, 31.391595), (120.739696, 31.38765), (120.74602, 31.410828),
#                           (120.802362, 31.436959), (120.832258, 31.441888), (120.836282, 31.391595), (120.85123, 31.370385),
#                           (120.866752, 31.356572), (120.884575, 31.317586), (120.855829, 31.285003), (120.817885, 31.300802),
#                           (120.805811, 31.285497), (120.81616, 31.273152), (120.810411, 31.271671), (120.785689, 31.270683),
#                           (120.763843, 31.238084), (120.743721, 31.235614), (120.743721, 31.235614)))

# 徐州市
# polygon_target = Polygon(((118.640238, 34.339068), (118.628904, 34.348954), (118.639826, 34.350447), (118.642418, 34.362114), (118.650849, 34.364886), (118.653043, 34.384957), (118.669444, 34.390129), (118.680267, 34.400743), (118.680679, 34.406359), (118.675344, 34.413375), (118.677586, 34.425333), (118.6633, 34.426762), (118.661843, 34.432634), (118.655366, 34.432758), (118.651455, 34.446057), (118.6408, 34.445753), (118.614557, 34.452644), (118.602433, 34.450008), (118.592127, 34.425547), (118.585011, 34.422699), (118.581081, 34.422918), (118.578584, 34.429219), (118.567055, 34.434778), (118.539264, 34.441414), (118.530823, 34.446091), (118.510376, 34.436364), (118.496426, 34.426064), (118.496308, 34.421872), (118.472751, 34.412822), (118.459277, 34.418168), (118.451839, 34.416768), (118.441116, 34.41961), (118.435893, 34.426695), (118.428627, 34.429494), (118.422239, 34.425969), (118.419918, 34.437051), (118.414963, 34.44186), (118.411244, 34.433388), (118.399866, 34.431973), (118.388906, 34.42601), (118.386353, 34.420958), (118.361247, 34.422971), (118.358784, 34.428799), (118.327388, 34.427693), (118.325123, 34.434635), (118.320462, 34.429336), (118.298882, 34.431258), (118.295681, 34.418997), (118.285266, 34.417372), (118.284014, 34.410439), (118.249002, 34.411505), (118.247394, 34.407853), (118.237603, 34.404728), (118.226753, 34.41201), (118.224205, 34.385345), (118.210847, 34.383693), (118.209343, 34.387248), (118.196093, 34.38694), (118.194159, 34.396527), (118.189603, 34.39636), (118.185827, 34.385597), (118.176982, 34.387357), (118.175439, 34.393943), (118.182366, 34.408139), (118.181518, 34.419529), (118.185399, 34.431566), (118.184301, 34.459392), (118.162393, 34.470828), (118.154045, 34.476587), (118.155317, 34.478537), (118.14664, 34.48099), (118.147955, 34.485588), (118.139526, 34.489085), (118.1502, 34.503966), (118.171573, 34.510811), (118.175899, 34.518374), (118.172907, 34.521018), (118.174426, 34.525977), (118.191152, 34.550427), (118.178948, 34.553011), (118.179672, 34.555858), (118.153047, 34.556549), (118.147395, 34.559658), (118.148983, 34.565427), (118.143863, 34.568895), (118.13924, 34.561466), (118.133108, 34.560541), (118.120605, 34.566754), (118.085199, 34.575839), (118.088536, 34.58616), (118.10486, 34.594546), (118.121335, 34.620032), (118.121433, 34.62528), (118.107261, 34.632355), (118.108064, 34.638448), (118.10095, 34.642373), (118.10939, 34.653591), (118.106538, 34.657329), (118.089139, 34.662272), (118.06402, 34.660886), (118.060521, 34.656732), (118.048041, 34.661665), (118.035189, 34.661443), (118.03543, 34.66529), (118.027438, 34.665843), (118.025296, 34.652738), (118.014346, 34.652922), (118.01401, 34.66159), (118.00395, 34.662537), (117.995508, 34.667754), (117.996394, 34.673852), (117.991384, 34.675765), (117.958925, 34.677613), (117.948886, 34.670256), (117.916671, 34.675988), (117.909336, 34.649982), (117.885983, 34.650951), (117.881508, 34.656523), (117.870045, 34.651057), (117.862154, 34.651677), (117.855762, 34.653434), (117.853017, 34.659073), (117.840652, 34.653503), (117.836461, 34.660453), (117.827674, 34.652627), (117.817416, 34.650556), (117.806073, 34.652991), (117.8066, 34.656263), (117.800488, 34.657391), (117.800281, 34.631602), (117.806182, 34.62655), (117.806383, 34.615432), (117.798069, 34.576963), (117.803328, 34.563701), (117.800411, 34.552571), (117.805999, 34.52601), (117.796191, 34.524587), (117.771952, 34.538187), (117.726002, 34.550653), (117.691194, 34.553585), (117.68853, 34.535181), (117.664723, 34.504349), (117.653702, 34.498504), (117.645266, 34.503294), (117.640992, 34.497445), (117.630446, 34.49314), (117.626651, 34.497041), (117.616027, 34.496523), (117.606353, 34.478045), (117.595602, 34.467619), (117.576905, 34.468717), (117.568228, 34.477449), (117.554739, 34.480749), (117.545078, 34.472436), (117.519566, 34.478456), (117.500859, 34.478776), (117.494175, 34.472236), (117.491144, 34.490469), (117.471665, 34.490712), (117.461521, 34.508632), (117.445005, 34.521919), (117.446208, 34.525821), (117.432955, 34.531159), (117.42671, 34.543793), (117.409599, 34.552934), (117.408739, 34.575276), (117.383137, 34.589386), (117.372533, 34.584243), (117.35836, 34.59002), (117.350499, 34.587865), (117.342499, 34.580909), (117.326062, 34.57892), (117.322656, 34.57473), (117.306613, 34.572501), (117.293597, 34.577131), (117.28615, 34.564396), (117.279748, 34.561712), (117.276876, 34.539188), (117.27326, 34.535724), (117.280365, 34.525702), (117.268405, 34.519036), (117.2809, 34.51715), (117.279839, 34.508112), (117.266065, 34.504264), (117.272334, 34.483773), (117.262391, 34.483241), (117.255088, 34.493063), (117.248682, 34.486469), (117.25219, 34.481512), (117.261761, 34.478738), (117.262296, 34.468124), (117.259691, 34.465547), (117.255935, 34.469917), (117.250599, 34.468043), (117.251087, 34.465076), (117.259093, 34.464971), (117.252536, 34.456654), (117.240434, 34.460335), (117.230095, 34.458222), (117.214723, 34.462173), (117.2192, 34.469902), (117.194252, 34.502073), (117.187447, 34.49809), (117.182327, 34.49891), (117.163287, 34.527808), (117.166632, 34.565678), (117.151749, 34.593477), (117.144632, 34.620778), (117.138112, 34.630996), (117.133826, 34.654179), (117.102324, 34.653722), (117.083744, 34.642936), (117.072943, 34.653232), (117.068693, 34.663272), (117.067868, 34.681651), (117.076377, 34.697681), (117.098142, 34.709234), (117.07088, 34.732707), (117.07165, 34.748066), (117.066454, 34.756511), (117.055214, 34.760636), (117.056589, 34.775557), (117.04795, 34.784527), (117.026028, 34.795971), (116.993153, 34.803642), (116.973423, 34.842783), (116.972352, 34.881024), (116.952267, 34.896699), (116.922805, 34.897928), (116.903001, 34.909214), (116.887468, 34.914059), (116.867221, 34.932031), (116.852709, 34.930116), (116.818482, 34.934218), (116.792789, 34.946008), (116.787854, 34.922701), (116.763402, 34.923561), (116.743872, 34.930234), (116.726256, 34.93228), (116.711602, 34.941536), (116.700217, 34.937843), (116.631863, 34.939504), (116.621221, 34.934863), (116.61049, 34.925144), (116.567351, 34.91449), (116.555112, 34.914696), (116.475565, 34.900825), (116.466061, 34.905414), (116.453253, 34.903727), (116.447218, 34.890887), (116.417712, 34.864271), (116.419468, 34.847025), (116.41613, 34.834426), (116.420438, 34.822363), (116.410602, 34.812006), (116.409323, 34.801574), (116.412758, 34.775675), (116.408604, 34.768068), (116.412818, 34.754649), (116.372285, 34.755895), (116.369088, 34.750302), (116.36856, 34.743492), (116.374914, 34.73749), (116.375009, 34.73174), (116.369934, 34.729946), (116.370356, 34.721127), (116.37744, 34.720177), (116.385107, 34.724791), (116.388923, 34.723762), (116.391872, 34.711026), (116.400074, 34.710676), (116.399744, 34.705648), (116.392225, 34.701085), (116.391511, 34.693015), (116.382419, 34.686962), (116.388336, 34.668934), (116.374462, 34.65486), (116.37716, 34.649394), (116.391086, 34.645294), (116.395647, 34.640324), (116.399917, 34.647806), (116.436696, 34.65681), (116.44474, 34.631499), (116.462164, 34.626001), (116.474347, 34.616308), (116.479281, 34.620482), (116.485737, 34.620766), (116.486073, 34.613334), (116.498038, 34.591274), (116.497135, 34.583681), (116.504641, 34.57308), (116.511763, 34.570902), (116.514482, 34.564577), (116.532304, 34.559709), (116.527385, 34.554185), (116.529327, 34.547868), (116.554167, 34.548067), (116.558998, 34.550445), (116.578105, 34.527868), (116.591972, 34.51825), (116.601867, 34.517266), (116.605616, 34.50597), (116.578247, 34.503082), (116.575877, 34.499313), (116.579935, 34.493127), (116.625532, 34.494048), (116.670358, 34.478281), (116.708023, 34.477043), (116.732473, 34.480256), (116.759264, 34.472398), (116.784483, 34.45633), (116.785265, 34.444779), (116.796268, 34.434651), (116.798782, 34.426712), (116.824825, 34.411634), (116.84206, 34.396345), (116.849238, 34.396135), (116.853438, 34.401427), (116.877512, 34.400366), (116.879006, 34.411432), (116.93534, 34.407307), (116.975893, 34.394813), (116.967499, 34.370895), (116.99088, 34.361883), (116.989124, 34.347224), (116.97681, 34.331764), (116.977182, 34.324229), (116.982779, 34.316739), (116.979355, 34.301656), (116.983248, 34.29685), (116.978884, 34.291378), (116.984764, 34.288662), (116.991709, 34.278527), (117.005332, 34.272091), (117.00867, 34.263994), (117.012762, 34.262503), (117.02351, 34.267196), (117.027521, 34.249197), (117.034459, 34.246256), (117.043475, 34.252591), (117.051888, 34.253577), (117.051532, 34.230512), (117.064932, 34.230761), (117.045128, 34.207406), (117.0339, 34.184692), (117.039012, 34.184449), (117.033465, 34.173667), (117.044943, 34.17327), (117.053669, 34.157144), (117.06157, 34.160763), (117.072448, 34.15723), (117.076014, 34.149235), (117.102113, 34.148954), (117.108728, 34.136442), (117.137963, 34.1329), (117.14353, 34.124809), (117.138367, 34.117461), (117.126836, 34.113006), (117.125746, 34.108826), (117.153123, 34.103888), (117.162964, 34.105112), (117.156716, 34.089684), (117.171611, 34.089047), (117.199333, 34.074459), (117.213613, 34.074575), (117.214376, 34.080656), (117.218672, 34.080736), (117.231191, 34.07041), (117.263553, 34.071903), (117.264416, 34.077977), (117.288555, 34.082729), (117.295731, 34.080282), (117.296344, 34.072586), (117.318889, 34.070956), (117.326846, 34.088932), (117.349792, 34.08706), (117.359527, 34.094744), (117.364134, 34.094914), (117.364388, 34.089997), (117.378784, 34.084097), (117.382906, 34.078749), (117.378428, 34.063672), (117.401289, 34.058621), (117.401688, 34.052104), (117.40656, 34.051699), (117.407036, 34.033471), (117.427062, 34.025253), (117.438733, 34.026504), (117.443148, 34.031716), (117.463134, 34.032776), (117.466055, 34.041711), (117.481135, 34.047718), (117.485547, 34.054705), (117.503483, 34.05443), (117.512315, 34.058713), (117.514617, 34.066131), (117.527738, 34.066151), (117.545718, 34.054821), (117.544033, 34.048008), (117.552788, 34.04005), (117.550484, 34.013455), (117.563414, 34.009864), (117.563319, 34.002209), (117.572276, 34.001726), (117.570343, 33.987508), (117.574258, 33.984471), (117.593049, 33.989043), (117.597093, 33.995407), (117.59438, 34.003335), (117.605606, 34.004468), (117.617848, 34.012442), (117.617071, 34.017436), (117.627497, 34.022457), (117.613749, 34.028356), (117.617004, 34.036008), (117.628759, 34.034159), (117.638296, 34.025135), (117.648789, 34.02435), (117.650029, 34.013809), (117.670747, 34.005828), (117.676917, 34.000052), (117.675709, 33.986165), (117.667669, 33.976814), (117.670062, 33.96352), (117.680506, 33.952259), (117.676898, 33.938546), (117.697308, 33.928467), (117.703458, 33.918293), (117.708964, 33.895012), (117.723179, 33.88691), (117.730813, 33.888115), (117.731473, 33.894286), (117.735939, 33.896969), (117.752559, 33.897244), (117.764631, 33.890637), (117.762458, 33.869179), (117.75903, 33.869217), (117.761808, 33.854824), (117.752697, 33.829816), (117.75974, 33.817491), (117.759377, 33.808816), (117.748381, 33.78367), (117.748702, 33.766971), (117.74224, 33.760802), (117.741743, 33.753609), (117.732347, 33.75269), (117.731548, 33.748928), (117.742749, 33.729136), (117.751932, 33.724721), (117.753289, 33.716915), (117.761058, 33.717024), (117.800674, 33.740254), (117.830654, 33.744541), (117.839459, 33.738143), (117.843549, 33.742067), (117.860347, 33.741866), (117.904091, 33.725172), (117.907949, 33.725836), (117.906399, 33.736059), (117.910335, 33.741863), (117.923912, 33.741611), (117.936231, 33.733315), (117.959665, 33.735703), (117.963487, 33.762662), (117.975845, 33.76669), (117.980413, 33.756434), (118.008654, 33.751455), (118.017255, 33.751955), (118.018666, 33.754967), (118.054735, 33.757139), (118.080231, 33.771802), (118.107224, 33.771476), (118.127297, 33.767802), (118.147409, 33.755366), (118.17517, 33.755832), (118.177422, 33.765147), (118.185128, 33.769257), (118.177031, 33.79222), (118.166292, 33.79793), (118.166016, 33.801104), (118.168313, 33.809761), (118.175485, 33.816472), (118.174198, 33.826784), (118.190282, 33.822524), (118.193717, 33.826819), (118.191259, 33.850448), (118.182376, 33.850454), (118.181135, 33.870786), (118.174731, 33.887021), (118.157173, 33.904187), (118.149961, 33.929912), (118.135789, 33.957836), (118.126602, 33.960524), (118.123599, 33.954968), (118.126105, 33.947234), (118.117755, 33.94135), (118.112643, 33.94119), (118.10562, 33.947961), (118.092218, 33.947856), (118.09185, 33.971801), (118.079138, 33.971626), (118.068633, 33.97721), (118.059644, 33.977962), (118.049307, 33.989397), (118.039329, 33.992604), (118.035064, 34.00406), (118.038772, 34.005481), (118.03666, 34.013034), (118.043951, 34.017354), (118.060713, 34.015768), (118.070043, 34.026607), (118.068179, 34.037565), (118.073352, 34.040697), (118.067536, 34.045102), (118.065759, 34.051299), (118.070279, 34.060025), (118.055179, 34.098508), (118.019738, 34.089588), (118.01217, 34.097371), (118.01507, 34.105714), (118.003224, 34.111538), (118.001337, 34.121589), (118.005593, 34.145879), (118.016939, 34.145041), (118.02368, 34.148703), (118.062069, 34.154916), (118.070647, 34.158766), (118.067092, 34.163237), (118.077936, 34.177369), (118.090285, 34.171399), (118.093148, 34.161612), (118.104579, 34.15596), (118.105346, 34.148177), (118.109089, 34.145747), (118.12734, 34.14986), (118.15091, 34.141187), (118.15945, 34.145313), (118.160929, 34.154182), (118.156499, 34.161984), (118.160631, 34.166042), (118.183811, 34.162509), (118.195993, 34.168568), (118.218352, 34.167384), (118.244267, 34.130547), (118.255142, 34.129508), (118.259198, 34.131728), (118.305678, 34.118587), (118.395465, 34.122558), (118.443932, 34.110497), (118.461444, 34.111705), (118.482099, 34.102172), (118.488854, 34.103994), (118.511162, 34.113659), (118.52056, 34.121764), (118.512298, 34.125813), (118.51153, 34.130101), (118.516324, 34.154463), (118.513434, 34.155317), (118.51281, 34.164058), (118.516447, 34.168212), (118.525822, 34.174384), (118.566876, 34.171903), (118.566392, 34.195697), (118.57803, 34.225538), (118.579996, 34.239572), (118.57037, 34.244889), (118.567578, 34.254351), (118.572862, 34.279467), (118.580999, 34.284651), (118.578386, 34.30444), (118.597973, 34.313851), (118.630157, 34.311357), (118.631444, 34.314002), (118.6391, 34.313635), (118.640238, 34.339068)))

"""
调用百度PlaceAPI爬取数据
"""
class PlaceService(object):
    def __init__(self):
        print "Constructor "

    def fetchPlace(self, index, bounds):
        # 最后一个token为企业号
        if index > len(goodAkList)-1:
            token = goodAkList[-1]
        else:
            token = goodAkList[index]
        snatcherService = BaiduMapSnatcherService(dao_setting["host"], dao_setting["db"], dao_setting["user"], dao_setting["password"], token)
        logger.debug('current index %s' % index)
        # 常用大类
        keywords = ["美食", "宾馆", "酒店", "购物", "汽车服务", "生活服务", "结婚", "丽人", "金融", "休闲娱乐", "运动健身", "医疗",
                    "旅游景点", "生活服务", "汽车服务", "教育", "培训机构", "交通设施", "房地产", "自然地物", "行政区划", "政府机构",
                    "公司企业", "门址", "道路", "交通线"]
        # 民政局-地名普查所需类型
        keywords = ["星级酒店", "购物中心", "家居建材", "集市", "批发市场", "邮局", "墓地陵园", "度假村", "农家院", "采摘园",
                    "文化宫", "电影院", "音乐厅", "剧院", "体育场馆", "医院", "疗养院", "旅游景点","学校","图书馆",
                    "飞机场","机场出入口","火车站","地铁站","长途汽车站","房地产",
                    "自然地物","行政区划","政府机构", "门址", "道路", "交通线"]
        # for keyword in keywords:
        #     logger.debug("keyword: %s " % keyword)
        #     snatcherService.fetchPlace(polygon_target,bounds[0], bounds[1], bounds[2], bounds[3], keyword,tableName="Place_SuZhou_GYYQ")
        #     # sysTime.sleep(1)
        #     pass

        # 从文件中读取关键字进行爬取
        f = open('keywords.txt', 'r')
        for line in f.readlines():
            logger.debug("keyword: %s " % line)
            snatcherService.fetchPlace(polygon_target,bounds[0], bounds[1], bounds[2], bounds[3], line,tableName="Place_Xuzhou")
        logger.debug("Process %s done" % index)

    def fetchPlaceDetail(self,index,bounds):
        if index > len(goodAkList)-1:
            token = goodAkList[-1]
        else:
            token = goodAkList[index]
        snatcherService = BaiduMapSnatcherService(dao_setting["host"], dao_setting["db"], dao_setting["user"], dao_setting["password"], token)
        logger.debug('current index %s' % index)
        logger.debug('current bounds:'+str(bounds))
        # keywords = ["宾馆", "酒店", "购物", "汽车服务", "生活服务", "结婚", "丽人", "金融", "休闲娱乐", "运动健身", "医疗",
        #             "旅游景点", "生活服务", "汽车服务", "教育", "培训机构", "交通设施", "房地产", "自然地物", "行政区划", "政府机构",
        #             "公司企业", "门址", "道路", "交通线"]
        # for key in keywords:
        f = open('keywords.txt', 'r')
        for line in f.readlines():
            snatcherService.fetchPlaceDetail(bounds[0], bounds[1], bounds[2], bounds[3],line)
        logger.debug("Process %s done" % index)

    def normalRequest(self):
        # 南海区桂城街道
        bounds = [113.129391, 22.98257, 113.261335, 23.072904]
        # 偏移测试
        bounds[0] -= 0.02
        self.fetchPlace(0, bounds)

    def concurrentRequest(self):
        # 南海区
        envelope=polygon_target.envelope
        bounds=list(envelope.bounds)

        # 偏移测试
        bounds[0] -= 0.02
        parts = 4
        # 区域长度分4份，将生成16个区域
        boundsList = GeoUtil().getBoundsList(bounds, parts)

        threads = []
        for index in range(0, len(boundsList), 1):
            print 'current bounds ...%s ' % index
            subBounds = boundsList[index]

            # 将extent转换成polygon
            coords=GeoUtil().getPolygonByExtent(subBounds)
            coords=tuple(coords)
            isIntersects=Polygon((coords)).intersects(polygon_target)
            if isIntersects:
                threads.append(gevent.spawn(self.fetchPlace, index, subBounds))
        gevent.joinall(threads)

    '''
    多线程爬取poi点的详细信息
    '''
    def mutiSearchPlace(self):
        envelope=polygon_target.envelope
        bounds=list(envelope.bounds)
        # 偏移测试
        bounds[0] -= 0.02
        parts = 50
        # 区域长度分4份，将生成16个区域
        boundsList = GeoUtil().getBoundsList(bounds, parts)
        threads = []
        # 将区域分成块，并按照每16个协程一个循环进行数据获取
        for index in range(0, len(boundsList)/16+1, 1):
            for threadIndex in range(index*16,(index+1)*16):
                if threadIndex < len(boundsList):
                    print 'current bounds ...%s ' % threadIndex
                    subBounds = boundsList[threadIndex]
                    # 将extent转换成polygon
                    coords=GeoUtil().getPolygonByExtent(subBounds)
                    coords=tuple(coords)
                    isIntersects=Polygon((coords)).intersects(polygon_target)
                    if isIntersects:
                        threads.append(gevent.spawn(self.fetchPlaceDetail, threadIndex%16, subBounds))
            gevent.joinall(threads)


if __name__ == '__main__':
    # python E:\PythonWorkspace\ugc\ugc.aggregator\src\main\scripts\PlaceService.py
    ts = time()
    service = PlaceService()
    # service.concurrentRequest()
    service.mutiSearchPlace()
    print 'Took %s' % format(time() - ts)
